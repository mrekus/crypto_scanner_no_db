<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wallet Gas & Balance Checker</title>
<style>
    :root{
        --bg:#f0f2f5;
        --card:#ffffff;
        --muted:#6b7280;
        --accent:#4CAF50;
        --accent-hover: #84b185;
        --danger:#f44336;
    }

    html,body{height:100%;margin:0;}
    body{
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
        background:var(--bg);
        display:flex;
        align-items:center;
        justify-content:center;
        padding:24px;
    }

    .card{
        width:min(420px,96%);
        max-width:420px;
        background:var(--card);
        border-radius:12px;
        box-shadow:0 10px 30px rgba(16,24,40,0.08);
        padding:28px;
        display:flex;
        flex-direction:column;
        gap:18px;
        align-items:center;
    }

    h1{font-size:22px;margin:0 0 8px;text-align:center;}
    p.lead{margin:0 0 18px;color:var(--muted);font-size:14px;text-align:center}

    .btn{
        display:inline-block;
        width:100%;
        padding:12px 14px;
        border-radius:10px;
        border:0;
        cursor:pointer;
        font-weight:600;
        background:var(--accent);
        color:#fff;
        text-align:center;
        margin:6px 0;
    }
    .btn.secondary{background:transparent;color:var(--accent);border:1px solid rgba(76,175,80,0.12)}
    .btn:active{transform:translateY(1px)}

    /* overlay / popup */
    .overlay{
        position:fixed;inset:0;display:none;align-items:center;justify-content:center;
        background:rgba(2,6,23,0.45);backdrop-filter:blur(4px);z-index:1200;
    }
    .popup{
        width:360px;background:var(--card);padding:20px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.25);
        display:flex;flex-direction:column;gap:10px;
    }
    .popup h2{margin:0;font-size:16px;text-align:center}
    .popup .actions{display:flex;gap:10px;justify-content:center;margin-top:6px}
    .popup .small{font-size:13px;color:var(--muted);text-align:center;margin-top:6px}

    /* toast (top center) */
    .toast{
        position:fixed;top:20px;left:50%;transform:translateX(-50%);padding:12px 18px;border-radius:10px;color:#fff;font-weight:700;display:none;z-index:1300;
    }
    .toast.error{background:var(--danger)}
    .toast.success{background:var(--accent)}
</style>
</head>
<body>

<div class="card" role="main">
    <h1>Wallet Gas & Balance Checker</h1>
    <p class="lead">Login or register to access the wallet calculator.</p>
    <button class="btn" onclick="showPopup('login')">Login</button>
    <button class="btn secondary" onclick="showPopup('register')">Register</button>
</div>

<!-- Overlay + Popup -->
<div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="popup" id="popup" role="document">
        <h2 id="popupTitle">Login</h2>

        <input type="text" id="username" placeholder="Username" autocomplete="username" />
        <input type="password" id="password" placeholder="Password" autocomplete="current-password" />

        <div class="actions">
            <button class="btn" id="submitBtn">Login</button>
        </div>

        <div class="small" id="popupNote"></div>
    </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<script>
const overlay = document.getElementById('overlay');
const popupTitle = document.getElementById('popupTitle');
const popupNote = document.getElementById('popupNote');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const submitBtn = document.getElementById('submitBtn');
const toastEl = document.getElementById('toast');

let currentAction = '';

function showPopup(action){
    currentAction = action;
    popupTitle.textContent = action === 'login' ? 'Login' : 'Register';
    submitBtn.textContent = action === 'login' ? 'Login' : 'Register';
    popupNote.textContent = action === 'register' ? 'After registration, please login.' : '';
    usernameInput.value = '';
    passwordInput.value = '';
    overlay.style.display = 'flex';
    overlay.setAttribute('aria-hidden','false');
    setTimeout(()=> usernameInput.focus(), 50);
}

overlay.addEventListener('click', (e)=>{
    if(e.target === overlay) overlay.style.display='none';
});

function showToast(message, type='error', ms=2500){
    toastEl.textContent = message;
    toastEl.className = 'toast ' + (type==='success'?'success':'error');
    toastEl.style.display='block';
    setTimeout(()=> toastEl.style.display='none', ms);
}

submitBtn.addEventListener('click', async ()=>{
    const username = usernameInput.value.trim();
    const password = passwordInput.value;
    if(!username || !password){
        showToast('Provide username and password', 'error');
        return;
    }

    const endpoint = currentAction==='login'?'/login':'/register';

    try{
        const res = await fetch(endpoint,{
            method:'POST',
            headers:{'Content-Type':'application/json','x-requested-with':'XMLHttpRequest'},
            body:JSON.stringify({username,password}),
            redirect:'follow'
        });

        const data = await res.json().catch(()=>({}));

        if(res.ok || data.success){
            if(currentAction==='login'){
                window.location.href='/calculator';
                return;
            }

            if(currentAction==='register'){
                showToast('Registration successful. Please login.', 'success');
                currentAction='login';
                popupTitle.textContent='Login';
                submitBtn.textContent='Login';
                popupNote.textContent='';
                passwordInput.value='';
                usernameInput.focus();
                return;
            }
        }

        const errMsg = data && data.error ? data.error : (res.statusText||'Error');
        showToast(errMsg,'error');

    }catch(err){
        showToast('Network error','error');
        console.error(err);
    }
});

document.addEventListener('keydown',(e)=>{
    if(e.key==='Escape' && overlay.style.display==='flex') overlay.style.display='none';
});
</script>
</body>
</html>
